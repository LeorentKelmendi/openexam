<?php

namespace OpenExam\Models;

use Exception;
use OpenExam\Tests\Phalcon\TestCase;
use OpenExam\Tests\Phalcon\TestModelAccess;
use OpenExam\Tests\Phalcon\TestModelBasic;

/**
 * @author Anders Lövgren (Computing Department at BMC, Uppsala University)
 */
class ExamModel extends Exam
{

        public function initialize()
        {
                parent::initialize();
        }

}

/**
 * Generated by PHPUnit_SkeletonGenerator 1.2.1 on 2014-09-15 at 19:03:31.
 * 
 * @author Anders Lövgren (Computing Department at BMC, Uppsala University)
 */
class ExamTest extends TestCase
{

        /**
         * @group model
         */
        public function testRelations()
        {
                $exam = Contributor::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->contributors->count());
                self::assertTrue(count($exam->contributors) > 0);

                $exam = Decoder::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertTrue(count($exam->decoders) > 0);
                self::assertNotEquals(0, $exam->decoders->count());

                $exam = Invigilator::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->invigilators->count());
                self::assertTrue(count($exam->invigilators) > 0);

                $exam = Question::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->questions->count());
                self::assertTrue(count($exam->questions) > 0);

                $exam = Student::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->students->count());
                self::assertTrue(count($exam->students) > 0);

                $exam = Topic::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->topics->count());
                self::assertTrue(count($exam->topics) > 0);

                $exam = Lock::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->locks->count());
                self::assertTrue(count($exam->locks) > 0);

                $exam = Resource::findFirst()->exam;
                self::assertNotNull($exam);

                self::assertNotEquals(0, $exam->resources->count());
                self::assertTrue(count($exam->resources) > 0);
        }

        /**
         * @group model
         */
        public function testProperties()
        {
                $values = array(
                        'creator' => $this->caller,
                        'orgunit' => 'orgunit1',
                        'grades'  => json_encode(array('data' => array('key1' => 'val1'))),
                        'name'    => 'name1'
                );

                try {
                        $helper = new TestModelBasic(new Exam());
                        $helper->tryPersist();
                        self::error("Excepted constraint violation exception");
                } catch (Exception $exception) {
                        // Expected exception
                }

                try {
                        $helper = new TestModelBasic(new Exam());
                        $helper->tryPersist($values);
                } catch (Exception $exception) {
                        self::error($exception);
                }

                $helper->checkDefaults(array(
                        'details'  => 3,
                        'decoded'  => false,
                        'testcase' => false,
                        'lockdown' => false
                ));

                $values = array(
                        'updated' => date('Y-m-d H:i:s'),
                        'created' => date('Y-m-d H:i:s'),
                        'details' => 3,
                        'creator' => $this->caller,
                        'orgunit' => 'orgunit1',
                        'grades'  => json_encode(array('data' => (array('key1' => 'val1')))),
                        'name'    => 'name1'
                );
                try {
                        $helper = new TestModelBasic(new Exam());
                        $helper->tryPersist($values);
                } catch (Exception $exception) {
                        self::error($exception);
                }

                $values = array(
                        'updated'   => date('Y-m-d H:i:s'),
                        'created'   => date('Y-m-d H:i:s'),
                        'details'   => 3,
                        'name'      => 'Name1',
                        'descr'     => 'Description1',
                        'starttime' => date('Y-m-d H:i:s'),
                        'endtime'   => date('Y-m-d H:i:s'),
                        'creator'   => $this->caller,
                        'decoded'   => true,
                        'orgunit'   => 'Orgunit1',
                        'grades'    => json_encode(array('data' => array())),
                        'testcase'  => true,
                        'lockdown'  => true
                );
                try {
                        $helper = new TestModelBasic(new Exam());
                        $helper->tryPersist($values);
                } catch (Exception $exception) {
                        print_r($values);
                        print_r($exception->getTrace());
                        self::error($exception);
                }
        }

        /**
         * @group model
         * @group security
         */
        public function testAccess()
        {
                $helper = new TestModelAccess(new Exam());
                $helper->testModelAccess();
        }

        /**
         * @covers OpenExam\Models\Exam::getSource
         * @group model
         */
        public function testGetSource()
        {
                $object = new ExamModel();
                $expect = "exams";
                $actual = $object->getSource();
                self::assertNotNull($actual);
                self::assertEquals($expect, $actual);
        }

}
