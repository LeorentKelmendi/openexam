<?php
// 
// The source code is copyrighted, with equal shared rights, between the
// authors (see the file AUTHORS) and the OpenExam project, Uppsala University 
// unless otherwise explicit stated elsewhere.
// 
// File:    main.phtml
// 
// Author:  Ahsan Shahzad (MedfarmDoIT)
// Author:  Anders LÃ¶vgren (QNET/BMC CompDept)
// 

?>

<?php
// 
// Add profiling check point:
// 
$this->profiler->add("view");

?>

<!-- CSS -->
<?= Phalcon\Tag::stylesheetLink('bootstrap3/css/bootstrap.min.css'); ?>
<?= Phalcon\Tag::stylesheetLink('bootstrap3/css/bootstrap-theme.min.css'); ?>
<?= Phalcon\Tag::stylesheetLink("css/uu/1.css"); ?>
<?= Phalcon\Tag::stylesheetLink("css/uu/2.css"); ?>
<?= Phalcon\Tag::stylesheetLink("css/uu/3.css"); ?>
<?= Phalcon\Tag::stylesheetLink("css/supermenu.css"); ?>
<?= Phalcon\Tag::stylesheetLink("css/accordion.css"); ?>
<?= Phalcon\Tag::stylesheetLink("css/font-awesome.css"); ?>
<?= Phalcon\Tag::stylesheetLink("plugins/fancy-box/source/jquery.fancybox.css"); ?>

<!-- Javascript -->
<?= Phalcon\Tag::javascriptInclude('plugins/fancy-box/source/jquery.fancybox.js'); ?>
<?= Phalcon\Tag::javascriptInclude('bootstrap3/js/bootstrap.min.js'); ?>
<?= Phalcon\Tag::javascriptInclude('js/views/layouts/supermenu.js'); ?>

<?php
$controllerName = $this->dispatcher->getControllerName();
$actionName = $this->dispatcher->getActionName();

?>

<!-- page wrapper -->

<div id="wrapper" class="wrapper"> 

    <!-- Header area -->
    <div id="header"> 

        <!-- Top navigation -->
        <div class="headerComponent componentContainer"> 

            <!-- Logo -->
            <div class="toppImg">
                <h1 class="logo"> <a href="http://www.uu.se/">
                        <?= Phalcon\Tag::image(array("img/uu_logo.svg", "style" => "max-height:120px")); ?>
                    </a> <span class="alt-logo">Uppsala universitet</span> </h1>
            </div>

            <!-- Logo Text -->
            <div class="toppNav"> <br>
                <br>
                <h1 class="siteName"> <a href="http://www.bmc.uu.se/">OpenExam</a> - online examination system </h1>
                <div style="position: absolute; top: 5px; right: 5px">
                    <?php if ($this->user->roles->isAdmin()) : ?>
                            <span class="btn btn-default">
                                <i class="fa fa-user"></i> <?= $this->catalog->getName() ?>
                            </span>
                    <?php else : ?>
                            <span class="btn btn-link" style="color: #c1002b;">
                                <i class="fa fa-user"></i> <?= $this->catalog->getName() ?>
                            </span>
                    <?php endif; ?>
                </div>
            </div>
        </div>

        <!-- Top menu -->
        <div id="topMenu"> 

            <!-- Top left menu -->
            <ul id="menucontainer">
                <li class="first <?= (($controllerName == 'public' && $actionName == 'index') ? 'selected' : '') ?>">
                    <?= Phalcon\Tag::linkTo('', 'Home') ?>
                </li>
                <?php if ($this->user->getUser()): ?>
                        <li class="<?= ($controllerName == 'exam' && $actionName == 'index' ? 'selected' : '') ?>">
                            <?= Phalcon\Tag::linkTo('exam/index', 'My Exams') ?>
                        </li>
                <?php endif; ?>
            </ul>
            <!-- Top right menu -->
            <ul id="menucontainer" style="float:right;" class="login-menu">
                <li id="login">
                    <?php
                    if (!$this->user->getUser()) {
                            print Phalcon\Tag::linkTo(array(
                                        sprintf("auth/login/%s", key($authenticators)),
                                        '<i class="fa fa-lock"></i> Login'
                            ));
                    } else {
                            print Phalcon\Tag::linkTo(array(
                                        "auth/logout",
                                        '<i class="fa fa-unlock-alt"></i> Logout'
                            ));
                    }

                    if (!$this->user->getUser()) {
                            printf("<ul class=\"login-menu\" style=\"visibility:hidden;\">\n");
                            foreach ($authenticators as $name => $auth) {
                                    if ($auth->visible) {
                                            print Phalcon\Tag::tagHtml("li");
                                            print Phalcon\Tag::linkTo(array(
                                                        sprintf("auth/login/%s", $name),
                                                        sprintf("<i class=\"fa\"></i> %s", $auth['desc'])
                                            ));
                                            print Phalcon\Tag::tagHtmlClose("li");
                                    }
                            }
                            printf("</ul>\n");
                    }

                    ?>
                </li>
            </ul>
            <ul id="menucontainer" style="float:right;" class="help-menu">
                <li id="help">
                    <?=
                    Phalcon\Tag::linkTo(array(
                            "help",
                            '<i class="fa fa-question-circle"></i> Help'
                    ));

                    ?>
                    <ul class="help-menu" style="visibility:hidden">
                        <li>
                            <?= Phalcon\Tag::linkTo('help/manual/teacher', 'Teacher Manual') ?>
                        </li>
                        <li>
                            <?= Phalcon\Tag::linkTo('help/manual/student', 'Student Manual') ?>
                        </li>
                        <li>
                            <?= Phalcon\Tag::linkTo(array('help/manual', 'Show All...', 'target' => '_blank', 'title' => 'Open page with manuals in other languages and formats in new window.')) ?>
                        </li>
                        <li>
                            <?= Phalcon\Tag::linkTo('about', 'About') ?>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul id="menucontainer" style="float:right;" class="tools-menu">
                <li id="tools">
                    <?=
                    Phalcon\Tag::linkTo(array("#", "Tools"));

                    ?>
                    <ul class="tools-menu" style="visibility:hidden">
                        <li>
                            <?= Phalcon\Tag::linkTo('utility/statistics', 'Statistics') ?>
                        </li>
                        <li>
                            <?= Phalcon\Tag::linkTo('utility/monitor/diagnostics', 'Diagnostics') ?>
                        </li>
                    </ul>
                </li>
            </ul>
            <?php if ($this->user->getUser()) : ?>
                    <ul id="menucontainer" style="float:right;" class="tasks-menu">
                        <li id="tasks">
                            <?=
                            Phalcon\Tag::linkTo(array("#", "Tasks"));

                            ?>
                            <ul class="tasks-menu" style="visibility:hidden">
                                <?php if ($this->user->roles->hasRole('teacher')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('exam/create', 'Create Exam...') ?>
                                        </li>
                                <?php endif; ?>
                                <?php if ($this->user->roles->hasRole('contributor')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('task/contribute', 'Contribute Questions') ?>
                                        </li>
                                <?php endif; ?>
                                <?php if ($this->user->roles->hasRole('corrector')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('task/correct', 'Correct Answers') ?>
                                        </li>
                                <?php endif; ?>
                                <?php if ($this->user->roles->hasRole('invigilator')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('task/invigilate', 'Invigilate Exam') ?>
                                        </li>
                                <?php endif; ?>
                                <?php if ($this->user->roles->hasRole('decoder')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('task/decode', 'Decode Exam') ?>
                                        </li>
                                <?php endif; ?>
                                <?php if ($this->user->roles->hasRole('student')) : ?>
                                        <li>
                                            <?= Phalcon\Tag::linkTo('task/result', 'Download Results') ?>
                                        </li>
                                <?php endif; ?>
                            </ul>
                        </li>
                    </ul>
            <?php endif; ?>
        </div>
    </div>

    <!-- Content area -->
    <div id="containerflarp">
        <div id="msg-box" class="alert" style="display:none"></div>
        <?= $this->getContent() ?>
    </div>

    <!-- Footer area -->
    <div id="footer">
        <div class="uuFooter">
            <div class="footerText">
                <div class="sidfot vcard" style="width: auto;"> &copy; 2010-<?= date('Y') ?> <a class="url fn org" href="http://www.uu.se/">Uppsala University</a> <a class="url fn org" href="http://www.bmc.uu.se/">BMC</a> </div>
            </div>
        </div>
    </div>
</div>
<!-- wrapper ends --> 
